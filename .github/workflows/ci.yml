name: CI - Bluesky Airflow Project

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ”¹ RÃ©cupÃ©rer le code
        uses: actions/checkout@v4

      - name: ðŸ”¹ Configurer Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12.7"

      - name: ðŸ”¹ Installer les dÃ©pendances Python
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      - name: ðŸ”¹ VÃ©rifier la syntaxe des scripts Python
        run: |
          python -m py_compile src/login_bsky.py
          python -m py_compile src/fetch_posts.py
          python -m py_compile src/mongo_connection.py
          python -m py_compile airflow-docker/dags/bsky_af_dag.py

  docker:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: ðŸ”¹ RÃ©cupÃ©rer le code
        uses: actions/checkout@v4

      - name: ðŸ”¹ VÃ©rifier la configuration Docker Compose
        run: |
          docker compose -f airflow-docker/docker-compose.yml config

      - name: ðŸ”¹ Construire les conteneurs Airflow
        run: |
          docker compose -f airflow-docker/docker-compose.yaml build
